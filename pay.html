<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pembayaran</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- ===== BACKGROUND MUSIC (GLOBAL) ===== -->
  <audio id="bgm" loop preload="auto">
    <source src="./assets/bgm.mp3" type="audio/mpeg">
  </audio>
  <!-- ===== /BACKGROUND MUSIC ===== -->

  <header class="topbar">
    <div class="wrap row">
      <a id="backBtn" class="btn small" href="./index.html">â† Kembali</a>

      <div class="grow">
        <h1>Pembayaran QRIS</h1>
        <p class="sub" id="info"></p>
      </div>

      <!-- Piringan Music -->
      <div id="musicDisc" class="music-disc" title="Play / Pause Music"></div>
    </div>
  </header>

  <main class="wrap">
    <div class="hero">
      <img class="heroImg" id="qrisImg" alt="QRIS">
    </div>

    <div class="row gap" style="margin-top:12px;">
      <a id="paidBtn" class="btn primary" href="#">Saya sudah bayar â†’ WhatsApp</a>
      <a id="productBtn" class="btn" href="#">Lihat produk</a>
    </div>

    <div class="note" style="margin-top:12px;">
      <div class="noteTitle">Kalau ke-reset / reload</div>
      <div class="noteText">
        Tenang. Kamu bisa klik â€œLihat produkâ€ atau balik ke halaman awal dan pilih â€œLanjutkan pembayaran terakhirâ€.
      </div>
    </div>
  </main>

  <script src="./data.js"></script>
  <script src="./pay.js"></script>

  <!-- ===== MUSIC SCRIPT (SINGLE, AUTO-RESUME) ===== -->
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    const bgm  = document.getElementById("bgm");
    const disc = document.getElementById("musicDisc");

    bgm.volume = 0.2;
    bgm.load();

    const wantPlay = localStorage.getItem("bgm_playing") === "1";

    // kalau sebelumnya user sudah nyalain musik, coba lanjutkan
    const tryResume = async () => {
      if (!wantPlay) return;
      try {
        await bgm.play();
        disc && disc.classList.add("playing");
      } catch {
        // Autoplay diblokir, kita tunggu 1x klik user
        showTapHint();
      }
    };

    // overlay kecil "Tap to enable music" (muncul cuma kalau diblokir)
    const showTapHint = () => {
      if (document.getElementById("tapMusicHint")) return;

      const hint = document.createElement("div");
      hint.id = "tapMusicHint";
      hint.textContent = "Tap di mana saja untuk menyalakan musik ğŸµ";
      hint.style.cssText = `
        position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
        background:rgba(0,0,0,.65); color:#fff; padding:10px 14px;
        border-radius:999px; font-weight:700; font-size:13px;
        z-index:99999; backdrop-filter:blur(8px);
      `;
      document.body.appendChild(hint);

      const unlock = async () => {
        try {
          await bgm.play();
          disc && disc.classList.add("playing");
          hint.remove();
          window.removeEventListener("pointerdown", unlock);
        } catch {}
      };

      // 1x tap/klik di mana saja untuk unlock audio
      window.addEventListener("pointerdown", unlock, { once: true });
    };

    // klik disc = toggle play/pause
    if (disc) {
      disc.addEventListener("click", async () => {
        try {
          if (bgm.paused) {
            await bgm.play();
            disc.classList.add("playing");
            localStorage.setItem("bgm_playing", "1");
          } else {
            bgm.pause();
            disc.classList.remove("playing");
            localStorage.setItem("bgm_playing", "0");
          }
        } catch {
          showTapHint();
        }
      });
    }

    bgm.addEventListener("play", () => localStorage.setItem("bgm_playing", "1"));
    bgm.addEventListener("pause", () => localStorage.setItem("bgm_playing", "0"));

    bgm.addEventListener("error", () => {
      alert("Audio gagal dimuat. Cek file ./assets/bgm.mp3");
      console.log("Audio src:", bgm.currentSrc);
    });

    tryResume();
  });
</script>

</body>
</html>



